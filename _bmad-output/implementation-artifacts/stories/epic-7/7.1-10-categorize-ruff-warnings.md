# Story 7.1-10: Categorize Ruff Warnings

Status: done

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a **Data Engineer**,
I want **Ruff code quality warnings to be categorized and triaged**,
so that **technical debt is tracked and the codebase health is visible**.

## Context

**Priority:** P2 (MEDIUM)
**Effort:** 2 hours (analysis/triage only; optional fixes in Task 6 require additional ~2-3h)
**Epic:** 7.1 - Pre-Epic 8 Bug Fixes & Improvements
**Source:** [Sprint Change Proposal](../sprint-change-proposal/sprint-change-proposal-2025-12-23-epic-7.1-pre-epic8-fixes.md)
**Ruff Version:** Verified with Ruff >=0.12.12 (run `uv show ruff` to confirm)

### Problem Statement

Currently, the codebase has an estimated **419 Ruff linting warnings** across multiple categories. These warnings represent technical debt and code quality issues that should be tracked, prioritized, and systematically addressed.

> [!WARNING]
> **Count Verification Required:** Sprint Change Proposal cites 1074 warnings. The actual count must be verified at implementation in Task 0. The 419 count was based on a sample run.

**Current Warning Distribution** (as of 2025-12-26):
| Category | Count | Description |
|----------|-------|-------------|
| **Total Warnings** | 419 | All Ruff checks on `src/` |
| **E501** (Line too long) | ~100 | Line length exceeds 88 characters |
| **PLR2004** (Magic value) | ~50 | Magic values in comparisons |
| **TID251** (Banned imports) | ~5 | Clean Architecture violations |
| **Other** | ~264 | Various code quality issues |

> [!NOTE]
> **Pre-Implementation Verification Required:** Run the following before starting:
> ```bash
> PYTHONPATH=src uv run --env-file .wdh_env ruff check src/ --output-format=json > ruff_analysis.json
> ```
> Document actual counts and categories in AC-1 deliverable.

### Why This Matters

**Technical Debt Visibility:**
- 419 warnings indicate accumulated code quality issues
- Categorization helps prioritize what to fix first
- Tracking prevents future debt accumulation

**Code Quality Standards:**
- Ruff warnings align with project's hard constraints (line length ‚â§ 88, magic values)
- Clean Architecture violations (TID251) are critical architecture boundaries

**Epic 8 Readiness:**
- Clean codebase reduces complexity for Classification-Based Validation
- Low warning count demonstrates code quality discipline

### Previous Story Intelligence

**From Story 7.1-9 (Test Cleanup):**
- Test suite now passes with 0 failures, 0 errors ‚úÖ
- Pattern: Run full test suite after changes to verify no regressions
- Pattern: Document findings in analysis document for future reference

**From Story 7.1-4 (company_mapping Removal):**
- Zero Legacy Policy applied rigorously ‚úÖ
- Pattern: Delete obsolete code completely, no backward compatibility
- Pattern: Remove all references (code, tests, docs, migrations)

**From Story 7.1-8 (EQC Confidence):**
- Configuration-driven pattern (YAML config for confidence scores) ‚úÖ
- Pattern: Configurable behavior via YAML vs hardcoded values

### Existing Infrastructure (MUST REUSE)

> [!CAUTION]
> **DO NOT CREATE NEW CONFIGURATION.** Use existing `pyproject.toml` Ruff configuration:

| File | Location | Usage |
|------|----------|-------|
| `pyproject.toml` | Project root | **Ruff configuration with line length, select rules, per-file ignores** |
| `scripts/quality/check_file_length.py` | Quality checks | Pre-commit hook for 800-line file limit |

**Current Ruff Configuration (from pyproject.toml):**
```toml
[tool.ruff]
line-length = 88
target-version = "py310"

[tool.ruff.lint]
select = ["E", "F", "W", "I", "PLR"]  # NOTE: PLR not PL
extend-select = ["TID"]  # tidy imports for Clean Architecture

# Per-file ignores defined for io/, orchestration/, scripts/, tests/.
# See pyproject.toml for full per-file-ignores.
```

> [!NOTE]
> **UP (pyupgrade) not enabled:** Pyupgrade rules are not in the current config. To enable, add `"UP"` to `extend-select` in pyproject.toml.

### Architecture Context

**Ruff Warning Categories:**

| Rule | Description | Priority |
|------|-------------|----------|
| **E501** | Line too long (>88 chars) | P2 - Formatting (auto-fixable) |
| **PLR2004** | Magic value comparison | P1 - Code quality (add constants) |
| **TID251** | Banned imports (Clean Architecture) | P0 - **Critical** |
| **F401** | Unused import | P2 - Cleanup |
| **PLR0913** | Too many arguments | P1 - Design smell |
| **UP** | Pyupgrade | P2 - Modern Python |

**Critical Patterns:**

1. **TID251 (Banned Imports):** Domain layer importing from IO layer
   ```python
   # ‚ùå WRONG: Domain ‚Üí IO dependency (violates Clean Architecture)
   # src/work_data_hub/auth/eqc_auth_handler.py:6
   from work_data_hub.io.connectors.eqc import EQCClient

   # ‚úÖ CORRECT: Use protocol/interface pattern
   from work_data_hub.infrastructure.enrichment import EnterpriseInfoProvider
   ```

2. **PLR2004 (Magic Values):** Hardcoded numbers in comparisons
   ```python
   # ‚ùå WRONG: Magic value
   if len(batch) > 10:
       process_batch(batch)

   # ‚úÖ CORRECT: Named constant
   BATCH_SIZE_LIMIT = 10
   if len(batch) > BATCH_SIZE_LIMIT:
       process_batch(batch)
   ```

3. **E501 (Line Length):** Auto-fixable with `ruff format`
   ```bash
   uv run ruff format src/
   ```

## Acceptance Criteria

### AC-1: Generate Ruff Warning Analysis

**GIVEN** the codebase has 419 Ruff warnings
**WHEN** warnings are analyzed by category and priority
**THEN** a comprehensive triage report is created

**Deliverable:** `docs/sprint-artifacts/reviews/ruff-warning-triage-7.1-10.md` (NEW)

**Analysis Template:**
```markdown
# Ruff Warning Triage Analysis (Story 7.1-10)

**Analysis Date:** 2025-12-26
**Total Warnings:** 419
**Analyzed by:** <dev-name>

## Summary

| Priority | Count | Categories |
|----------|-------|------------|
| **P0 (Critical)** | X | TID251 (Clean Architecture violations) |
| **P1 (High)** | X | PLR2004 (Magic values), PLR0913 (Too many args) |
| **P2 (Medium)** | X | E501 (Line length), F401 (Unused imports) |
| **P3 (Low)** | X | UP (Pyupgrade), other stylistic issues |

## Category Breakdown

### P0 - Critical (Clean Architecture Violations)

**TID251: Banned Imports**

**Affected Files:**
- `src/work_data_hub/auth/eqc_auth_handler.py:6` - `work_data_hub.io` import
- <list all other TID251 violations>

**Root Cause:**
Domain layer (`work_data_hub.auth`) importing from IO layer (`work_data_hub.io.connectors`).

**Fix Strategy:**
1. Use protocol/dependency injection pattern
2. Move import to orchestration layer
3. See Story 1.6 Clean Architecture for reference

**Estimated Effort:** 2-4 hours

### P1 - High (Code Quality Issues)

**PLR2004: Magic Value Comparison**

**Affected Files:**
- `src/migrations/migrate_legacy_to_enrichment_index.py:165, 215`
- <list all other PLR2004 violations>

**Fix Strategy:**
Replace magic numbers with named constants at module level.

**Estimated Effort:** 1-2 hours

**PLR0913: Too Many Arguments (6+)**

**Affected Files:**
- <list functions with 6+ parameters>

**Fix Strategy:**
Refactor to use dataclasses or configuration objects.

**Estimated Effort:** 2-3 hours

### P2 - Medium (Formatting & Cleanup)

**E501: Line Too Long (>88)**

**Count:** ~100 warnings

**Fix Strategy:**
```bash
uv run ruff format src/  # Auto-fix most
```
Manual fixes for remaining long lines (break URLs, docstrings).

**Estimated Effort:** 30 minutes

**F401: Unused Import**

**Fix Strategy:**
```bash
uv run ruff check --select F401 --fix src/
```

**Estimated Effort:** 15 minutes

### P3 - Low (Stylistic)

**UP: Pyupgrade Recommendations**

**Fix Strategy:**
```bash
uv run ruff check --select UP --fix src/
```

**Estimated Effort:** 30 minutes

## Prioritized Fix Plan

### Sprint 7.1 - Immediate (P0 only)
- Fix all TID251 violations (Clean Architecture)

### Epic 7.1 Tech Debt - P1 (if time permits)
- Fix PLR2004 (Magic values)
- Fix PLR0913 (Too many arguments)

### Epic 8 Preparation - P2 (Automated)
- Run `ruff format` for E501
- Run `ruff check --select F401,UP --fix`

### Ongoing - P3 (Deferred)
- Address remaining stylistic issues incrementally

## Recommendations

### Immediate Actions:
1. ‚úÖ Fix TID251 violations (critical architecture boundary)
2. ‚ö†Ô∏è Add `# noqa: TID251` with TODO for complex refactors
3. üìä Track warning count in sprint status

### Preventive Measures:
1. Enable `--fix` mode in pre-commit hooks
2. Add Ruff check to CI gate (fail on P0 violations)
3. Review and update `pyproject.toml` select rules quarterly
```

### AC-2: Categorize Warnings by Priority

**GIVEN** 419 Ruff warnings exist
**WHEN** warnings are grouped by priority (P0/P1/P2/P3)
**THEN** triage document clearly shows fix priority order

**Categories:**

| Priority | Definition | Rules |
|----------|------------|-------|
| **P0 - Critical** | Architecture violations | TID251 (banned imports) |
| **P1 - High** | Code quality smells | PLR2004, PLR0913, PLR0912 |
| **P2 - Medium** | Formatting & cleanup | E501, F401, F841 |
| **P3 - Low** | Stylistic | UP, C90 (complexity) |

**Deliverable:** Priority table in triage document (AC-1)

### AC-3: Document Fix Strategy per Category

**GIVEN** warnings are categorized
**WHEN** fix strategy is documented for each category
**THEN** developer has clear action plan

**Fix Strategies:**

| Category | Fix Command | Effort | Auto-fixable |
|----------|-------------|--------|--------------|
| TID251 | Manual refactor | 2-4h | ‚ùå No |
| PLR2004 | Add constants | 1-2h | ‚ùå No |
| PLR0913 | Refactor signatures | 2-3h | ‚ùå No |
| E501 | `ruff format` | 30m | ‚úÖ Yes |
| F401 | `ruff --select F401 --fix` | 15m | ‚úÖ Yes |
| UP* | `ruff --select UP --fix` | 30m | ‚úÖ Yes |

> *UP (pyupgrade) requires adding to `extend-select` in pyproject.toml first.

**Deliverable:** Fix strategy table in triage document (AC-1)

### AC-4: Create Technical Debt Stories (Optional)

**GIVEN** P0 and P1 warnings require significant effort
**WHEN** tech debt exceeds 4 hours
**THEN** create separate backlog stories for systematic resolution

**Story Creation Criteria:**

| Category | Count | Effort | Create Story? |
|----------|-------|--------|---------------|
| TID251 | ~5 | 2-4h | ‚úÖ Yes - Story 7.1-12 |
| PLR2004 | ~50 | 1-2h | ‚ö†Ô∏è Maybe - if >30 occurrences |
| PLR0913 | ~10 | 2-3h | ‚ö†Ô∏è Maybe - if >5 functions |
| E501 | ~100 | 30m | ‚ùå No - automated fix |
| F401 | ~20 | 15m | ‚ùå No - automated fix |
| UP | ~50 | 30m | ‚ùå No - automated fix |

**Deliverable (if applicable):**
- Add tech debt stories to sprint-status.yaml as `backlog`
- Reference triage analysis in story descriptions

### AC-5: Update pyproject.toml Documentation

**GIVEN** Ruff configuration exists in `pyproject.toml`
**WHEN** warning analysis is complete
**THEN** configuration is documented with rationale

**Documentation Updates:**

Add comments to existing pyproject.toml Ruff configuration:

```toml
# pyproject.toml - Document current configuration (DO NOT change rules without approval)

[tool.ruff.lint]
# Current rules: E, F, W (pycodestyle), I (isort), PLR (pylint refactor), TID (tidy imports)
# NOTE: UP (pyupgrade) not enabled - add to extend-select if needed
select = ["E", "F", "W", "I", "PLR"]
extend-select = ["TID"]  # Clean Architecture enforcement (Story 1.6)

[tool.ruff.lint.per-file-ignores]
# TODO: TID251 violations - Track in Story 7.1-12 if >3 occurrences
"src/work_data_hub/io/**/*.py" = ["TID251"]
"src/work_data_hub/orchestration/**/*.py" = ["TID251"]
```

**Deliverable:** Updated `pyproject.toml` with documented rationale

### AC-6: Track Warning Count in Sprint Status

**GIVEN** initial warning count is 419
**WHEN** story is completed
**THEN** sprint status tracks current warning baseline

**Sprint Status Update:**

```yaml
# docs/sprint-artifacts/sprint-status.yaml

development_status:
  # ...
  7.1-10-categorize-ruff-warnings: done

# Add new section for technical debt metrics
technical_debt_metrics:
  ruff_warnings:
    baseline: 419  # Story 7.1-10
    p0_critical: 5  # TID251 violations
    p1_high: 60  # PLR2004, PLR0913
    p2_medium: 120  # E501, F401
    p3_low: 234  # UP, other
```

**Deliverable:** Sprint status updated with technical debt metrics

## Tasks / Subtasks

- [x] **Task 0: Pre-Implementation Verification** (Validation Fix)
  - [x] 0.1 Run `uv show ruff` to verify Ruff version (>=0.12.12)
  - [x] 0.2 Run `PYTHONPATH=src uv run --env-file .wdh_env ruff check src/ --statistics` to get actual counts
  - [x] 0.3 Document actual warning count (update 419 if different from SCP's 1074)
  - [x] 0.4 Verify enabled rules: `ruff check --show-settings src/ | grep -A5 "select"`

- [x] **Task 1: Pre-Implementation Analysis** (AC-1)
  - [x] 1.1 Run `PYTHONPATH=src uv run --env-file .wdh_env ruff check src/ --output-format=json > ruff_analysis.json`
  - [x] 1.2 Parse JSON and group warnings by error code
  - [x] 1.3 Count occurrences per category (E501, PLR2004, TID251, etc.)
  - [x] 1.4 Map each code to priority (P0/P1/P2/P3)
  - [x] 1.5 List affected files for P0/P1 categories

- [x] **Task 2: Create Triage Document** (AC-1, AC-2, AC-3)
  - [x] 2.1 Create `docs/sprint-artifacts/reviews/ruff-warning-triage-7.1-10.md`
  - [x] 2.2 Document summary table with priority breakdown
  - [x] 2.3 Add category breakdown with affected files
  - [x] 2.4 Document fix strategy per category
  - [x] 2.5 Add prioritized fix plan (immediate vs deferred)

- [x] **Task 3: Identify Technical Debt Stories** (AC-4)
  - [x] 3.1 Assess TID251 violations - create Story 7.1-12 if >3 occurrences
  - [x] 3.2 Assess PLR2004 violations - create story if >30 occurrences
  - [x] 3.3 Assess PLR0913 violations - create story if >5 functions
  - [x] 3.4 Add stories to sprint-status.yaml as backlog (if applicable)
  - [x] 3.5 Reference triage analysis in story descriptions

- [x] **Task 4: Document Ruff Configuration** (AC-5)
  - [x] 4.1 Review current `pyproject.toml` Ruff configuration
  - [x] 4.2 Add comments explaining each rule category
  - [x] 4.3 Add per-file ignores for TID251 with TODO references
  - [x] 4.4 Document line length rationale (88 vs 100)

- [x] **Task 5: Update Sprint Status** (AC-6)
  - [x] 5.1 Add `technical_debt_metrics` section to sprint-status.yaml
  - [x] 5.2 Record baseline warning count (from Task 0 verification)
  - [x] 5.3 Record P0/P1/P2/P3 breakdown
  - [x] 5.4 Mark Story 7.1-10 as done

- [ ] **Task 6: Optional - Quick Wins** (AC-3)
  - [ ] 6.1 Run `uv run ruff format src/` (E501 fixes)
  - [ ] 6.2 Run `uv run ruff check --select F401 --fix src/` (unused imports)
  - [ ] 6.3 *Optional:* To enable UP, first add `"UP"` to `extend-select` in pyproject.toml, then run `uv run ruff check --select UP --fix src/`
  - [ ] 6.4 Verify automated fixes don't break tests

## Dev Notes

### Architecture Patterns to Follow

**1. Ruff Configuration Pattern:**

```toml
# pyproject.toml - Actual Ruff configuration structure
[tool.ruff]
line-length = 88
target-version = "py310"

[tool.ruff.lint]
select = ["E", "F", "W", "I", "PLR"]
extend-select = ["TID"]  # Clean Architecture enforcement

[tool.ruff.lint.per-file-ignores]
# Per-file ignores with TODO comments
"src/work_data_hub/io/**/*.py" = ["TID251"]
"src/work_data_hub/orchestration/**/*.py" = ["TID251"]
```

**2. TID251 Fix Pattern (Clean Architecture):**

```python
# ‚ùå WRONG: Domain layer imports IO layer
# src/work_data_hub/auth/eqc_auth_handler.py
from work_data_hub.io.connectors.eqc import EQCClient

# ‚úÖ CORRECT: Use protocol/dependency injection
from work_data_hub.infrastructure.enrichment import EnterpriseInfoProvider

class EQCAuthHandler:
    def __init__(self, provider: EnterpriseInfoProvider):
        self._provider = provider
```

**3. Magic Value Fix Pattern:**

```python
# ‚ùå WRONG: Magic value
if len(batch) > 10:
    process_batch(batch)

# ‚úÖ CORRECT: Named constant
BATCH_SIZE_LIMIT = 10  # Configured via YAML in production

if len(batch) > BATCH_SIZE_LIMIT:
    process_batch(batch)
```

### Project Structure Notes

**Alignment with Unified Project Structure:**

Ruff applies to all Python source files in `src/`:
```
src/
‚îú‚îÄ‚îÄ work_data_hub/
‚îÇ   ‚îú‚îÄ‚îÄ auth/           # ‚ö†Ô∏è TID251 violations (eqc_auth_handler.py)
‚îÇ   ‚îú‚îÄ‚îÄ cli/            # ‚ö†Ô∏è E501 violations (long docstrings)
‚îÇ   ‚îú‚îÄ‚îÄ domain/         # ‚úÖ Clean (Clean Architecture enforced)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/ # ‚úÖ Clean
‚îÇ   ‚îú‚îÄ‚îÄ io/             # ‚ö†Ô∏è PLR2004 violations (magic values)
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # ‚ö†Ô∏è E501 violations (long docstrings)
```

**No Conflicts:** This story is analysis and documentation only, no code changes required (unless quick wins in Task 6).

### Error Handling Specification

**Ruff Exit Codes:**
- `0`: No errors found (success)
- `1`: Errors found (linting failed)
- `2`: Invalid command line usage

**Continuous Integration:**

```bash
# Pre-commit hook pattern (Story 7.6)
#!/bin/bash
uv run ruff check src/ || {
    echo "‚ùå Ruff check failed. Fix warnings before committing."
    exit 1
}
```

### Testing Standards

**Verification:**

After automated fixes (Task 6), verify:
```bash
# Run full test suite
PYTHONPATH=src uv run --env-file .wdh_env pytest tests/ -v

# Verify no formatting broke code
PYTHONPATH=src uv run --env-file .wdh_env python -m work_data_hub.cli.etl --help
```

### Known Issues to Consider

**From Epic 8 Readiness Assessment:**

1. **TID251 Violations (Critical):**
   - Impact: Violates Clean Architecture boundary
   - Count: ~5 violations (estimated from sample)
   - Priority: P0 - Must fix before Epic 8

2. **E501 Line Length (Auto-fixable):**
   - Impact: Code formatting consistency
   - Count: ~100 violations (estimated)
   - Priority: P2 - Can fix with `ruff format`

3. **PLR2004 Magic Values:**
   - Impact: Code maintainability
   - Count: ~50 violations (estimated)
   - Priority: P1 - Should fix for long-term health

### References

- [Sprint Change Proposal: Epic 7.1](../sprint-change-proposal/sprint-change-proposal-2025-12-23-epic-7.1-pre-epic8-fixes.md) - Section 3.1: Story 7.1-10
- [Ruff Documentation](https://docs.astral.sh/ruff/) - Rule definitions and fix strategies
- [Project Context](../project-context.md) - Section 1: Hard Constraints (line length)
- [Story 1.6: Clean Architecture](./1-6-clean-architecture-boundaries-enforcement.md) - TID251 rule rationale
- [Story 7.6: CI Integration](./7-6-ci-integration-code-quality-tooling.md) - Pre-commit hooks
- [Story 7.1-9](./7.1-9-clean-up-failing-tests.md) - Pattern: Document analysis findings

### Implementation Checklist

**Pre-Implementation:**
- [x] Review current Ruff warning count (419)
- [x] Review Ruff configuration in `pyproject.toml`
- [x] Understand priority categories (P0/P1/P2/P3)
- [x] Identify automated fix opportunities (E501, F401, UP)

**Implementation:**
- [x] Run Ruff with JSON output for analysis
- [x] Group warnings by error code and priority
- [x] Create triage document with fix strategies
- [x] Assess tech debt story creation criteria
- [x] Document Ruff configuration rationale
- [x] Update sprint status with technical debt metrics
- [ ] Optional: Run automated fixes (ruff format, F401, UP)

**Post-Implementation:**
- [x] Verify triage document completeness
- [x] Confirm sprint status updated
- [ ] Verify no test regressions (if automated fixes applied)
- [x] Hand off to PM for tech debt story prioritization

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes List

**Story Completed:** 2025-12-26
**Context Source:** Sprint Change Proposal (Story 7.1-10) + Ruff Warning Analysis

**Implementation Summary:**
- ‚úÖ **Task 0:** Pre-implementation verification completed
  - Ruff version: 0.13.0 (‚â• 0.12.12 ‚úì)
  - Actual warning count: 419 (matches story estimate)
  - Verified enabled rules: E, F, W, I, PLR, TID

- ‚úÖ **Task 1:** Ruff warning analysis completed
  - Total warnings: 419
  - P0 (Critical): 11 (TID251)
  - P1 (High): 162 (PLR code quality)
  - P2 (Medium): 215 (E501, F841, E402)
  - P3 (Low): 31 (TID252)

- ‚úÖ **Task 2:** Triage document created
  - Created comprehensive triage analysis
  - Documented fix strategies per category
  - Prioritized fix plan (immediate vs deferred)
  - Identified auto-fixable warnings: 246 (59%)

- ‚úÖ **Task 3:** Technical debt stories created
  - Story 7.1-15: Fix TID251 violations (11 occurrences, P0)
  - Story 7.1-16: Refactor magic values (66 occurrences, P1)
  - Story 7.1-17: Reduce function complexity (96 violations, P1)
  - Added to sprint-status.yaml as backlog

- ‚úÖ **Task 4:** Ruff configuration documented
  - Added comments to pyproject.toml explaining each rule category
  - Documented line length rationale (88 vs 100)
  - Added per-file ignore references with TODO comments

- ‚úÖ **Task 5:** Sprint status updated
  - Added technical_debt_metrics section to sprint-status.yaml
  - Recorded baseline: 419 warnings
  - Recorded P0/P1/P2/P3 breakdown
  - Story marked as review

**Key Findings:**
1. **Warning Count Verified:** 419 warnings (not 1074 from SCP estimate)
2. **Auto-fixable Potential:** 59% of warnings (246/419) can be auto-fixed
3. **Critical Priority:** TID251 violations minimal (11), Clean Architecture well-enforced
4. **Quick Win Opportunity:** `ruff format` + `--fix` can reduce warnings by 58%

**Deliverables:**
1. ‚úÖ Ruff Warning Triage Analysis document
2. ‚úÖ 3 Technical Debt Stories (7.1-15, 7.1-16, 7.1-17)
3. ‚úÖ Updated pyproject.toml with documented configuration
4. ‚úÖ Updated sprint-status.yaml with technical_debt_metrics

**Story Status:** review (Tasks 0-5 completed, Task 6 optional)

### File List

**Analysis Document (NEW):**
- `docs/sprint-artifacts/reviews/ruff-warning-triage-7.1-10.md`

**Configuration Files (MODIFIED):**
- `pyproject.toml` (Added Ruff configuration documentation comments)

**Sprint Status (MODIFIED):**
- `docs/sprint-artifacts/sprint-status.yaml` (Added technical_debt_metrics section + 3 new tech debt stories)

**Tech Debt Stories (CREATED - AC-4):**
- `docs/sprint-artifacts/stories/7.1-15-fix-tid251-clean-architecture-violations.md` (P0 - 11 violations)
- `docs/sprint-artifacts/stories/7.1-16-refactor-magic-values-to-constants.md` (P1 - 66 violations)
- `docs/sprint-artifacts/stories/7.1-17-reduce-function-arity-complexity.md` (P1 - 96 violations)

**Source Files (Analysis Only - No Modifications):**
- All files in `src/` directory (Ruff analysis target)

---

## Validation Record

**Validated:** 2025-12-26
**Validator:** Claude Opus 4.5 (LLM Quality Validator)
**Validation Report:** [validation-report-7.1-10-2025-12-26.md](./validation-report-7.1-10-2025-12-26.md)
**Validation Score:** 20/24 (83%) ‚Üí All improvements applied

### Improvements Applied

| ID | Type | Issue | Fix Applied |
|----|------|-------|-------------|
| C1 | CRITICAL | Warning count discrepancy (419 vs 1074) | ‚úÖ Added WARNING note + Task 0 verification |
| C2 | CRITICAL | UP rule not enabled but referenced | ‚úÖ Added cautionary notes, updated Task 6.3 |
| C3 | CRITICAL | pyproject.toml config mismatch | ‚úÖ Updated all config excerpts to match actual |
| E1 | ENHANCEMENT | Missing Task 0 pre-verification | ‚úÖ Added Task 0 with version/count verification |
| E2 | ENHANCEMENT | Effort scope unclear (2h = analysis) | ‚úÖ Added effort clarification in Context |
| E3 | ENHANCEMENT | Ruff version not documented | ‚úÖ Added Ruff Version field |
| E4 | ENHANCEMENT | AC-5 pyproject.toml incorrect | ‚úÖ Updated to match actual configuration |
| O1 | OPTIMIZATION | Task 5.2 hardcoded count | ‚úÖ Changed to "from Task 0 verification" |
| O2 | OPTIMIZATION | Dev Notes pattern incorrect | ‚úÖ Updated to match actual pyproject.toml |

**Story Strengths (Retained):**
- ‚úÖ Comprehensive AC breakdown with GIVEN/WHEN/THEN format
- ‚úÖ Existing infrastructure references (pyproject.toml)
- ‚úÖ Previous story intelligence (7.1-9, 7.1-4, 7.1-8)
- ‚úÖ Git intelligence (recent commit patterns)
- ‚úÖ Clear task breakdown with pre-verification step (Task 0 added)
