<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Project Structure and Development Environment Setup</title>
    <status>drafted</status>
    <generatedAt>2025-11-09</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-project-structure-and-development-environment-setup.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>data engineer</asA>
    <iWant>a well-organized project structure with modern Python tooling configured</iWant>
    <soThat>I have a clean foundation for building the data platform with type safety and code quality guarantees</soThat>
    <tasks>
- Initialize uv project with Python 3.10+ (AC: 1)
  - Create `pyproject.toml` with project metadata and Python 3.10+ requirement
  - Create `.python-version` file
  - Initialize uv virtual environment

- Create Clean Architecture directory structure (AC: 2)
  - Create `src/domain/__init__.py` (pure business logic layer)
  - Create `src/io/__init__.py` (data access layer)
  - Create `src/orchestration/__init__.py` (Dagster integration layer)
  - Create `src/cleansing/__init__.py` (data quality rules)
  - Create `src/config/__init__.py` (configuration management)
  - Create `src/utils/__init__.py` (shared utilities)
  - Create `tests/` directory structure

- Install and lock dependencies (AC: 3)
  - Add production dependencies: pandas, pydantic (2.11.7+), structlog, psycopg2-binary, alembic, dagster, dagster-webserver
  - Add dev dependencies: mypy (1.17.1+), ruff (0.12.12+), pytest, pytest-cov, pytest-postgresql
  - Run `uv lock` to create reproducible `uv.lock`
  - Verify all dependencies install correctly with `uv sync`

- Create environment configuration (AC: 4)
  - Create `.env.example` template with: DATABASE_URL, DAGSTER_HOME, LOG_LEVEL, ENVIRONMENT placeholders
  - Create comprehensive `.gitignore` covering: `.env`, `__pycache__/`, `*.pyc`, `.pytest_cache/`, `.mypy_cache/`, `*.py[cod]`, `*$py.class`, `.coverage`, `htmlcov/`

- Document project structure (AC: 2)
  - Create `README.md` explaining directory structure and Clean Architecture layers
  - Document setup instructions: `uv sync`, environment configuration
  - Document uv usage and benefits (10-100x faster than pip)
    </tasks>
  </story>

  <acceptanceCriteria>
1. **Project initialized with uv package manager**
   - ✅ `pyproject.toml` exists with `[project]` metadata
   - ✅ `uv.lock` file committed to git (reproducible builds)
   - ✅ `.python-version` file specifies Python 3.10+

2. **Directory structure follows Clean Architecture pattern**
   - ✅ Required directories exist: `src/domain/`, `src/io/`, `src/orchestration/`, `src/config/`, `src/utils/`, `tests/`
   - ✅ Each directory has `__init__.py` for Python package recognition
   - ✅ `README.md` documents directory structure and purpose

3. **Core dependencies installed**
   - ✅ Production dependencies: pandas, pydantic, structlog, psycopg2-binary, alembic, dagster
   - ✅ Dev dependencies: mypy, ruff, pytest, pytest-cov, pytest-postgresql
   - ✅ All dependencies pinned in `uv.lock`

4. **Environment configuration template provided**
   - ✅ `.env.example` file with placeholder values (DATABASE_URL, LOG_LEVEL, etc.)
   - ✅ `.env` added to `.gitignore` (security requirement)
   - ✅ `.gitignore` covers Python artifacts: `__pycache__/`, `*.pyc`, `.pytest_cache/`, `.mypy_cache/`
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Technical Specification - Epic 1: Foundation &amp; Core Infrastructure</title>
        <section>In Scope &amp; Technology Stack Alignment</section>
        <snippet>Epic 1 establishes project structure with Python 3.10+, uv package manager, and modern tooling. Clean Architecture boundaries defined: domain/ (pure logic), io/ (data access), orchestration/ (Dagster). Technology choices: uv for 10-100x faster dependency management, mypy strict mode for 100% type coverage NFR, ruff for linting.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Technical Specification - Epic 1</title>
        <section>Architecture Alignment - Decision #7</section>
        <snippet>Story 1.1 establishes directory layout (domain/, io/, orchestration/, cleansing/, config/, utils/) following PEP 8 standards: snake_case for modules/functions, PascalCase for classes, UPPER_SNAKE_CASE for constants. All future epics follow this structure.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision #7: Comprehensive Naming Conventions</section>
        <snippet>100+ stories require consistent naming standards. Python artifacts follow PEP 8. Without standards, AI agents create inconsistent code across the codebase.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Technology Stack (Locked In)</section>
        <snippet>Core technologies: Python 3.10+, uv package manager, mypy strict mode, ruff for linting, pytest for testing, Dagster for orchestration, PostgreSQL with Alembic migrations.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Code Organization: Clean Architecture</section>
        <snippet>Project follows Clean Architecture pattern with clear separation: domain/ (pure business logic), io/ (infrastructure/I/O operations), orchestration/ (Dagster integration). Domain layer has NO external dependencies and is 100% unit testable.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Team-Ready Maintainability NFR</section>
        <snippet>100% type safety required - mypy must pass with no errors, all public functions have type hints. Built for team handoff with clear separation of concerns and modern Python tooling.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 1: Foundation &amp; Core Infrastructure / Story 1.1</section>
        <snippet>Story 1.1 creates well-organized project structure with modern Python tooling, establishing clean foundation for data platform with type safety and code quality guarantees. Foundational story that enables all subsequent domain migrations.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>pyproject.toml</path>
        <kind>config</kind>
        <symbol>project configuration</symbol>
        <lines>1-50</lines>
        <reason>Already configured with Python 3.10+, core dependencies (dagster, pandas, pydantic, psycopg2-binary), dev dependencies (pytest, ruff, mypy), and pytest markers. Story may need to verify/update versions per AC requirements.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/__init__.py</path>
        <kind>module</kind>
        <symbol>package initialization</symbol>
        <lines>all</lines>
        <reason>Main package entry point for work_data_hub. Clean Architecture structure already established.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/domain</path>
        <kind>directory</kind>
        <symbol>domain layer</symbol>
        <lines>n/a</lines>
        <reason>Pure business logic layer (Clean Architecture). Must have NO imports from io/ or orchestration/. Already exists in codebase.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/io</path>
        <kind>directory</kind>
        <symbol>I/O layer</symbol>
        <lines>n/a</lines>
        <reason>Data access layer for file reading, database writes, external APIs. May import from domain/. Already exists.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/orchestration</path>
        <kind>directory</kind>
        <symbol>orchestration layer</symbol>
        <lines>n/a</lines>
        <reason>Dagster integration layer that wires together domain/ and io/. Already exists.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/cleansing</path>
        <kind>directory</kind>
        <symbol>cleansing layer</symbol>
        <lines>n/a</lines>
        <reason>Registry-driven data cleansing rules (Epic 2). Already exists.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/config</path>
        <kind>directory</kind>
        <symbol>configuration layer</symbol>
        <lines>n/a</lines>
        <reason>Pydantic settings and configuration management (Story 1.4). Already exists.</reason>
      </artifact>
      <artifact>
        <path>src/work_data_hub/utils</path>
        <kind>directory</kind>
        <symbol>utilities layer</symbol>
        <lines>n/a</lines>
        <reason>Shared utility functions (logging Story 1.3, date parsing). Already exists.</reason>
      </artifact>
      <artifact>
        <path>tests</path>
        <kind>directory</kind>
        <symbol>test suite</symbol>
        <lines>n/a</lines>
        <reason>Test directory with subdirectories: unit/, integration/, fixtures/, e2e/, smoke/. Pytest markers configured in pyproject.toml.</reason>
      </artifact>
      <artifact>
        <path>.env.example</path>
        <kind>config</kind>
        <symbol>environment template</symbol>
        <lines>all</lines>
        <reason>Environment variable template. AC-4 requires placeholders for DATABASE_URL, LOG_LEVEL, etc. Already exists - verify completeness.</reason>
      </artifact>
      <artifact>
        <path>.gitignore</path>
        <kind>config</kind>
        <symbol>git ignore rules</symbol>
        <lines>all</lines>
        <reason>Git ignore configuration. AC-4 requires .env, __pycache__/, *.pyc, .pytest_cache/, .mypy_cache/ coverage. Already exists - verify completeness.</reason>
      </artifact>
      <artifact>
        <path>uv.lock</path>
        <kind>config</kind>
        <symbol>dependency lock file</symbol>
        <lines>all</lines>
        <reason>Reproducible dependency lock created by uv. AC-1 requires this file committed to git. Already exists.</reason>
      </artifact>
    </code>
    <dependencies>
      <python>
        <production>
          <package name="pandas" version="latest" />
          <package name="pydantic" version=">=2.11.7" note="AC-3 specifies 2.11.7+ for row-level validation" />
          <package name="structlog" version="latest" note="Decision #8: structured logging" />
          <package name="psycopg2-binary" version="latest" />
          <package name="alembic" version="latest" note="Database schema management" />
          <package name="dagster" version="latest" />
          <package name="dagster-webserver" version="latest" />
          <package name="openpyxl" version="latest" note="Excel reading" />
          <package name="PyYAML" version="latest" />
          <package name="pydantic-settings" version=">=2.10.1" />
        </production>
        <dev>
          <package name="mypy" version=">=1.17.1" note="AC-3 specifies 1.17.1+ for strict type checking" />
          <package name="ruff" version=">=0.12.12" note="AC-3 specifies 0.12.12+ for linting/formatting" />
          <package name="pytest" version="latest" />
          <package name="pytest-cov" version="latest" note="Code coverage reporting" />
          <package name="pytest-postgresql" version="latest" note="PostgreSQL testing fixtures" />
        </dev>
      </python>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture">
      <rule>Clean Architecture Boundaries - domain/ must have NO imports from io/ or orchestration/ layers</rule>
      <source>Architecture Decision #7, Tech Spec Epic 1</source>
    </constraint>
    <constraint type="architecture">
      <rule>Layer dependency flow: orchestration/ → io/ → domain/ (unidirectional only)</rule>
      <source>PRD Code Organization, Architecture Doc</source>
    </constraint>
    <constraint type="technology">
      <rule>Python 3.10+ required (corporate standard, type system maturity)</rule>
      <source>AC-1, Tech Spec, .python-version file</source>
    </constraint>
    <constraint type="technology">
      <rule>uv package manager required for dependency management (10-100x faster than pip)</rule>
      <source>AC-1, Architecture Technology Stack</source>
    </constraint>
    <constraint type="quality">
      <rule>100% type coverage NFR - mypy strict mode must pass with no errors</rule>
      <source>PRD Maintainability NFR, Story 1.2 CI/CD enforcement</source>
    </constraint>
    <constraint type="naming">
      <rule>PEP 8 naming: snake_case (modules/functions), PascalCase (classes), UPPER_SNAKE_CASE (constants)</rule>
      <source>Architecture Decision #7</source>
    </constraint>
    <constraint type="security">
      <rule>.env files must NEVER be committed to git (contains sensitive credentials)</rule>
      <source>AC-4 security requirement</source>
    </constraint>
    <constraint type="dependency">
      <rule>All dependencies must be locked in uv.lock for reproducible builds</rule>
      <source>AC-1</source>
    </constraint>
    <constraint type="dependency">
      <rule>Specific minimum versions: pydantic >=2.11.7, mypy >=1.17.1, ruff >=0.12.12</rule>
      <source>AC-3, Dev Notes</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>work_data_hub package structure</name>
      <kind>Python package hierarchy</kind>
      <signature>src/work_data_hub/ with subpackages: domain/, io/, orchestration/, cleansing/, config/, utils/</signature>
      <path>src/work_data_hub/__init__.py</path>
      <note>Main package entry point. Each subpackage must have __init__.py for Python package recognition (AC-2).</note>
    </interface>
    <interface>
      <name>pytest test discovery</name>
      <kind>Test framework configuration</kind>
      <signature>tests/ directory with subdirectories for unit/, integration/, fixtures/</signature>
      <path>pyproject.toml</path>
      <note>Pytest configured with custom markers for test categorization: unit, integration, postgres, monthly_data, legacy_data, sample_domain.</note>
    </interface>
    <interface>
      <name>Environment configuration</name>
      <kind>Configuration template</kind>
      <signature>.env.example with placeholders: DATABASE_URL, DAGSTER_HOME, LOG_LEVEL, ENVIRONMENT</signature>
      <path>.env.example</path>
      <note>Template for environment variables. Developers copy to .env and fill in actual values. .env is gitignored (AC-4).</note>
    </interface>
  </interfaces>

  <tests>
    <standards>
Testing framework: pytest with custom markers for test categorization. Test directory structure separates unit tests (fast, no external dependencies), integration tests (database/filesystem), and fixtures (test data). All tests must use appropriate markers. Pytest configuration in pyproject.toml defines markers: @pytest.mark.unit (fast &lt;1s), @pytest.mark.integration (with database &lt;10s), @pytest.mark.postgres (requires PostgreSQL), @pytest.mark.monthly_data (opt-in), @pytest.mark.legacy_data (opt-in), @pytest.mark.sample_domain (non-production). Story 1.11 will enforce in CI/CD pipeline.
    </standards>
    <locations>
      <location>tests/unit/ - Fast unit tests with no external dependencies</location>
      <location>tests/integration/ - Integration tests with database or filesystem</location>
      <location>tests/fixtures/ - Test data and golden datasets</location>
      <location>tests/e2e/ - End-to-end tests</location>
      <location>tests/smoke/ - Smoke tests for quick validation</location>
    </locations>
    <ideas>
      <test id="AC-1" criteria="Project initialized with uv package manager">
        <description>Verify pyproject.toml exists with [project] metadata, uv.lock exists, .python-version specifies Python 3.10+</description>
        <type>unit</type>
      </test>
      <test id="AC-2" criteria="Directory structure follows Clean Architecture">
        <description>Verify all required directories exist (src/domain/, src/io/, src/orchestration/, src/config/, src/utils/, tests/) and each has __init__.py</description>
        <type>unit</type>
      </test>
      <test id="AC-3" criteria="Core dependencies installed">
        <description>Verify production dependencies (pandas, pydantic, structlog, etc.) and dev dependencies (mypy, ruff, pytest, etc.) are in pyproject.toml with correct versions</description>
        <type>unit</type>
      </test>
      <test id="AC-4" criteria="Environment configuration template">
        <description>Verify .env.example exists with required placeholders (DATABASE_URL, LOG_LEVEL, etc.), .env in .gitignore, Python artifacts in .gitignore</description>
        <type>unit</type>
      </test>
      <test id="README" criteria="Project documentation">
        <description>Verify README.md exists and documents directory structure, Clean Architecture layers, and setup instructions</description>
        <type>unit</type>
      </test>
    </ideas>
  </tests>
</story-context>
