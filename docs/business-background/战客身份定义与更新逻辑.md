# ---

**核心字段规范：Status Year (年度身份锚点)**

**所属表**: customer.customer\_plan\_contract

**相关业务规则**: 战客名单管理 (Strategic Client Management)

**最后更新**: 2026-02-05

## ---

**1\. 字段定义与设计意图**

**status\_year (INTEGER)** 不是简单的“当前年份”或者"记录创建时源数据的年份"，它是\*\*“业务考核年度”的身份锚点\*\*。

它的核心作用是**锁定分母**。它解决了以下核心矛盾：

* **矛盾**：业务需要考核“年初定下的那批战客”在一年内的表现，但客户的资产数据是每日波动的。  
* **解决方案**：通过 status\_year 将客户在某一年份的“初始身份”与“后续行为”绑定，确保历史数据不可篡改。

## ---

**2\. 核心业务规则 (Business Rules)**

基于业务确认，该字段遵循三大原则：

### **原则一：年度切断 (Annual Cutover)**

* **规则**：无论客户状态是否变化，跨年时刻（1月1日）必须强制生成新记录。  
* **目的**：区分“2024年的战客”与“2025年的战客”。2024年的记录将被永久封存（valid\_to 截止），不可被2025年的规则污染。

### **原则二：期初锁定 (Initial Lock)**

* **规则**：每年的 status\_year 初始名单，完全基于**上一年 12月 31日** 的数据快照生成。  
* **条件**：按 机构 \+ 产品线 排名 Top N 或 AUM \>= 阈值。

### **原则三：只增不减 (The "Ratchet" Rule)**

* **规则**：在同一个 status\_year 内，战客身份 (is\_strategic) 具有**棘轮效应**。  
  * **可以晋升**：如果普通客户在年中（如6月）AUM 增长达到了阈值，生成新记录，标记为战客。  
  * **不可降级**：如果年初确定的战客在年中 AUM 下跌低于阈值，**仍然保留战客身份**（直到下一年初重新评估）。

## ---

**3\. 详细更新逻辑 (Implementation Logic)**

开发人员需在 **Post-ETL Hook** 中实现以下三类逻辑：

### **3.1 年度初始化 (每年 1月 1日 执行)**

**场景**：新的一年开始，重置所有人的身份。

1. **输入**：business.规模明细 (上年12月数据)。  
2. **计算**：根据 AUM 排名/阈值，计算出 strategic\_candidates 列表。  
3. **操作**：  
   * **关旧**：将所有 valid\_to \= '9999-12-31' 的记录，更新 valid\_to \= 'YYYY-01-01'。  
   * **开新**：为所有活跃客户插入新记录：  
     * status\_year: **当前年份**  
     * valid\_from: 'YYYY-01-01'  
     * is\_strategic: 如果在 strategic\_candidates 中则为 TRUE，否则为 FALSE。

### **3.2 日常/月度更新 (SCD Type 2 维护)**

**场景**：常规 ETL 运行后，检测状态变更。

**伪代码逻辑**：

Python

def check\_status\_change(current\_db\_record, new\_data):  
    \# 1\. 获取当前数据库中的身份  
    is\_strategic\_db \= current\_db\_record.is\_strategic  
      
    \# 2\. 计算基于当前最新 AUM 的理论身份  
    is\_strategic\_calculated \= check\_threshold(new\_data.aum)  
      
    \# 3\. 应用“只增不减”规则判定最终身份  
    final\_strategic\_status \= is\_strategic\_db \# 默认为保持原样  
      
    if is\_strategic\_db \== False and is\_strategic\_calculated \== True:  
        \# \[晋升\]：普通客户 \-\> 战客  
        final\_strategic\_status \= True   
        trigger\_scd\_update \= True  
          
    elif is\_strategic\_db \== True and is\_strategic\_calculated \== False:  
        \# \[保护\]：战客 \-\> (业绩下滑) \-\> 依然是战客  
        final\_strategic\_status \= True  \# 保持为 True  
        trigger\_scd\_update \= False     \# 不需要更新 SCD 记录  
          
    \# ... 其他状态 (如 contract\_status) 变更判定 ...

### **3.3 状态流转示意图**

* **T1 (1月1日)**: 初始化，status\_year=2025, is\_strategic=True (基于去年业绩)。  
* **T2 (5月)**: 业绩下滑，但在 2025 分组下，is\_strategic 保持 True (**只增不减**)。  
* **T3 (明年1月1日)**: 跨年重算。由于业绩在年底未达标，生成新记录 status\_year=2026, is\_strategic=False。

## ---

**4\. 分析场景与 SQL 示例**

基于此逻辑，业务部门的 KPI 统计将变得非常简单且准确。

### **场景 A：计算“年初核心战客”的年度流失率**

*这是业务最看重的指标：年初定的那批人，丢了多少？*

SQL

SELECT   
    COUNT(CASE WHEN contract\_status \= '流失' THEN 1 END) \* 1.0 / COUNT(\*) as churn\_rate  
FROM customer.customer\_plan\_contract  
WHERE   
    status\_year \= 2025              \-- 锁定 2025 考核年度  
    AND is\_strategic \= TRUE         \-- 筛选战客  
    AND valid\_from \= '2025-01-01';  \-- 仅筛选“年初”那一刻生成的基准名单

### **场景 B：统计“年度净增战客”**

*今年有多少黑马客户晋升为战客？*

SQL

SELECT COUNT(DISTINCT company\_id)  
FROM customer.customer\_plan\_contract  
WHERE   
    status\_year \= 2025   
    AND is\_strategic \= TRUE   
    AND valid\_from \> '2025-01-01'; \-- 1月1日之后变成战客的，即为新增

### **场景 C：历史回溯 (2024年数据)**

*即使现在是2026年，查询2024年的数据依然精准。*

SQL

SELECT \* FROM customer.customer\_plan\_contract  
WHERE status\_year \= 2024; \-- 无论现在规则怎么变，取出的永远是2024年封存的快照

## ---

**5\. 开发实施 Checklist**

在实施 Contract Status Sync 时，请确保：

* \[ \] **ETL Hook**：引入 status\_year 变量，取值为 business.规模明细 数据日期的年份。  
* \[ \] **AUM 阈值配置**：将 Top N 或 AUM 阈值做成可配置参数（Configurable），不要硬编码在代码中。  
* \[ \] **晋升逻辑测试**：编写单元测试，模拟“年中 AUM 暴涨”场景，验证是否正确生成新 SCD 记录。  
* \[ \] **保级逻辑测试**：编写单元测试，模拟“战客 AUM 下跌”场景，验证是否**没有**生成新记录（保持 is\_strategic=True）。