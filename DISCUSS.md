
# 业务背景

- 目标场景：公司ID用于哪些核心分析/报表/下游系统？【`company_id`为外部平台的E企查的关键字段，通过该字段关联多个该平台的数据报表，还可以提高客户主体识别率(如企业客户改名(包括数据质量问题导致存在多种不统一的名称)，在内部业务数据会同时出现旧名、新名两种数据，但通过E企查平台进行查询可以关联到同一个`company_id`，即正确识别为同一个客户)】
- 覆盖范围：仅“规模明细”，还是还包含其它事实域？【还会包括全量客户、战客名单等其他一些内部事实域】
- 命名口径：是否需要跨批次/跨域统一的“规范公司ID”？【需要对已经建立关联的事实表和`company_id`进行统一规范】

现有数据模型

- 数据库与版本：Postgres/MySQL/其它（版本）【Postgres】
- 事实表：库/表名、主键/唯一键、company_id 列语义（是否可新增 company_alias_id）【可以根据需要增加任意字段】
- 参考/维表：如“年金计划”“组合计划”“账户映射”等表名+关键列【待定】
- 现有视图/触发器/外键：是否存在/可用？【项目和数据库均在重构中，可根据实现需要进行改造】

内部映射来源（现行）

- 覆盖配置：如 plan_code -> company_id 的来源与表/文件路径【由业务数据进行提取确认】
- 账户映射：年金账户号/名 -> company_id 的表+字段【由业务数据进行提取确认】
- 名称映射：公司名称/曾用名 -> company_id 的表+字段；清洗规则（去后缀等）【由E企查平台的曾用名字段进行映射】
- 命中率现状：近一批/日的未命中比例与典型失败原因【待定】

外部企业信息（爬虫/Provider）

- 来源与协议：EQC/QCC/其它；认证方式（token 等）【目前暂由手动查询GET请求参数获得，后续应该可实现自动获取】
- 速率与成本：每分钟限额/单次成本/总预算【无限制】
- 字段能力：是否能返回统一社会信用代码、官方名、别名、历史名？【包括，E企查平台为企业工商信息平台，涵盖企业自身大量信息`legacy/annuity_hub/crawler/qcc_crawler.py`】
- 期望集成：仅异步批量、还是允许同步小预算查询？【待定】

处理流程与时序

- 写入路径：导入批次触发时点与时长要求（SLA）【无限制】
- 异步模块：爬虫是否作为独立 CLI/服务运行？触发频率/并发数【爬虫模块独立运行，可以有效提供主流程的完成效率】
- 队列/中间产物：是否允许使用“请求队列表/中间CSV/NDJSON”【无限制】

一致性与准确性

- 内部优先：是否要求“内部映射命中即不再外呼”？【是】
- 临时ID策略：是否采用“IN_前缀别名ID”，其格式/可重复性（如 IN_{日期}_{序号} 或 HMAC）【无限制】
- 规范化策略：冲突处理（低置信度是否需要人工复核流转）【需要】
- 可接受的错误：允许的误识别率/需要的人审阈值【需要】

查询与对接方式（非常关键）

- 汇总报表/查询习惯：是否可接受通过 JOIN company_id_xref 映射到规范ID？[可]
- 替代方案偏好：若不接受 JOIN，是否愿意周期性批量重写事实表的 IN → 规范ID？【无限制】
- 性能约束：平均/峰值查询量、允许的 JOIN 层级与延迟上限【无限制】

非功能与合规

- 安全合规：密钥管理、PII/保密字段、脱敏与留存周期【无限制】
- 审计追踪：是否需要记录 alias→canonical 变更历史、证据与操作者【无限制】
- 环境限制：是否允许新增 schema/表/索引/视图；是否禁止触发器/存储过程【无限制】

验收标准（量化为主）

- 符合"KISS (Keep It Simple, Stupid)"和"YAGNI (You Aren't Gonna Need It)"设计原则

迁移与回滚

- 历史数据：是否需要对历史批次统一“规范化ID”？时间窗口与可停机时段【新项目重构，已脱离实际生产环境，无限制】
- 回滚策略：错误映射如何撤销与再跑（技术与流程）新项目重构，已脱离实际生产环境，无限制】

样例（强烈建议提供3–5条）

- 请查看原结构下的业务数据系统结构`reference/db_migration/db_structure.json`
