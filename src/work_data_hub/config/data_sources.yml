# WorkDataHub Data Sources Configuration
#
# This file defines the configuration for discovering and processing data files
# from different business domains. Each domain specifies:
# - pattern: Unicode-aware regex for filename matching with named groups
# - select: Strategy for choosing between multiple matching files
# - sheet: Excel sheet to process (0-indexed or sheet name)
# - description: Human-readable description of the domain

domains:
  # Trustee Performance Reports
  # Handles files with patterns like: "2024_11_受托业绩报告.xlsx", "2023-12-受托业绩数据.xlsx"
  trustee_performance:
    description: "Annual trustee performance reports with Chinese naming conventions"
    
    # Unicode-aware regex pattern with named groups for year/month extraction
    # Matches patterns: YYYY[separator]MM*受托业绩*.xlsx
    # Separators: -, _, /, or none
    # Month: 1-12 with optional leading zero
    pattern: "(?P<year>20\\d{2})[-_/]?(?P<month>0?[1-9]|1[0-2]).*受托业绩.*\\.xlsx$"
    
    # Selection strategy when multiple files match
    # - "latest_by_year_month": Select file with highest (year, month) tuple
    # - "latest_by_mtime": Select file with most recent modification time
    select: "latest_by_year_month"
    
    # Excel sheet to process (0 = first sheet)
    sheet: 0
    
    # Database table configuration for loader
    table: "trustee_performance"
    pk: ["report_date", "plan_code", "company_code"]
    
    # Data quality requirements
    required_columns:
      - "年"           # Year column
      - "月"           # Month column
      - "计划代码"     # Plan code
    
    # Optional validation rules
    validation:
      min_rows: 1
      max_file_age_days: 365

  # Example of a second domain (commented out for now)
  # annuity_performance:
  #   description: "Annuity performance data files"
  #   pattern: "(?P<year>\\d{4}).*年金.*\\.xlsx$"
  #   select: "latest_by_mtime"
  #   sheet: 0
  #   required_columns:
  #     - "年金代码"
  #     - "收益率"

# Global file discovery settings
discovery:
  # File types to scan for
  file_extensions:
    - ".xlsx"
    - ".xlsm"
  
  # Directories to exclude from scanning
  exclude_directories:
    - "temp"
    - "backup"
    - "archive"
    - ".git"
    - "__pycache__"
  
  # File patterns to ignore
  ignore_patterns:
    - "~$*"        # Excel temp files
    - "*.tmp"      # Temporary files
    - "*.bak"      # Backup files
    - "*.eml"      # Email files
    - ".*"         # Hidden files
  
  # Recursion settings
  max_depth: 10         # Maximum directory depth to scan
  follow_symlinks: false # Whether to follow symbolic links