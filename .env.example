# WorkDataHub Environment Variables Template
# Copy this file to .env and customize the values for your environment
# DO NOT commit .env files to version control

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

# Application name
WDH_APP_NAME=WorkDataHub

# Enable debug mode for development (true/false)
WDH_DEBUG=false

# =============================================================================
# LOGGING CONFIGURATION (Story 1.3)
# =============================================================================

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable file logging (0=disabled, 1=enabled)
# When enabled, logs are written to daily-rotated files with 30-day retention
LOG_TO_FILE=0

# Directory for log files (only used when LOG_TO_FILE=1)
# Files are named: workdatahub-YYYYMMDD.log
LOG_FILE_DIR=logs/

# =============================================================================
# DATA PROCESSING CONFIGURATION
# =============================================================================

# Base directory for data file discovery
WDH_DATA_BASE_DIR=./data

# Path to data sources configuration YAML file
WDH_DATA_SOURCES_CONFIG=./src/work_data_hub/config/data_sources.yml

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================

# Maximum Excel file size to process (in MB)
WDH_MAX_FILE_SIZE_MB=100

# Maximum number of concurrent processing workers
WDH_MAX_WORKERS=4

# =============================================================================
# DEVELOPMENT SETTINGS (Optional)
# =============================================================================

# Limit processing to N rows for development testing
# Uncomment and set value to enable row limiting
# WDH_DEV_SAMPLE_SIZE=1000

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Database host
WDH_DATABASE__HOST=localhost

# Database port
WDH_DATABASE__PORT=5432

# Database username
WDH_DATABASE__USER=wdh_user

# Database password - CHANGE THIS IN PRODUCTION!
WDH_DATABASE__PASSWORD=changeme

# Database name
WDH_DATABASE__DB=wdh

# =============================================================================
# DATABASE URI OVERRIDE (Optional)
# =============================================================================

# Complete database URI - if set, overrides individual database settings above
# Format: postgresql://username:password@host:port/database_name
# WDH_DATABASE__URI=postgresql://wdh_user:changeme@localhost:5432/wdh

# =============================================================================
# EXTERNAL API CONFIGURATION
# =============================================================================

# EQC (E企查) API Token
# This token is required for company information enrichment
# To obtain the token:
# 1. Login to https://eqc.pingan.com/
# 2. Open F12 Developer Tools -> Network tab
# 3. Perform any search on the website
# 4. Find the API request containing '/api/search'
# 5. Copy the 'token' value from Request Headers
# Note: Token expires after 30 minutes of inactivity
# WDH_EQC_TOKEN=your_32_character_token_here

# =============================================================================
# SECURITY NOTES
# =============================================================================

# 1. Never commit .env files to version control
# 2. Use strong passwords in production
# 3. Consider using environment-specific config files
# 4. Rotate credentials regularly
# 5. Use secrets management tools for production deployments

# =============================================================================
# EQC AUTH SETTINGS (Optional; for local development only)
# =============================================================================

# Login URL (you can use the direct login route below if needed)
# EQC_LOGIN_URL=https://eqc.pingan.com/#/login?redirect=%2Fhome

# Credentials (do NOT commit real values; only use locally)
# EQC_USERNAME=
# EQC_PASSWORD=
# EQC_OTP=

# Behavior flags
# EQC_AUTO_SLIDER=true
# EQC_REUSE_SESSION=true
# Ignore saved session but keep file
# EQC_CLEAR_SESSION=false
# Remove storage_state file before each run (strong reset)
# EQC_RESET_STORAGE=false

# Session persistence path
# EQC_STORAGE_STATE=.cache/eqc_storage_state.json

# Token capture URL substrings (comma-separated). Default only captures search API.
# EQC_CAPTURE_URL_SUBSTR=/kg-api-hfd/api/search/

# -----------------------------------------------------------------------------
# Recommended Profiles (uncomment one block below as needed)
# -----------------------------------------------------------------------------

# [First Login - Clean Run]
# Use this once to force a fresh login (no cached session). After success,
# switch to the Daily Use profile below.
# EQC_LOGIN_URL=https://eqc.pingan.com/#/login?redirect=%2Fhome
# EQC_AUTO_SLIDER=true
# EQC_REUSE_SESSION=false
# EQC_CLEAR_SESSION=true
# EQC_RESET_STORAGE=true
# EQC_STORAGE_STATE=.cache/eqc_storage_state.json
# EQC_CAPTURE_URL_SUBSTR=/kg-api-hfd/api/search/

# [Daily Use - Fast Path]
# Reuse the saved session to avoid frequent logins. Disable both CLEAR/RESET.
# EQC_LOGIN_URL=https://eqc.pingan.com/#/login?redirect=%2Fhome
# EQC_AUTO_SLIDER=true
# EQC_REUSE_SESSION=true
# EQC_CLEAR_SESSION=false
# EQC_RESET_STORAGE=false
# EQC_STORAGE_STATE=.cache/eqc_storage_state.json
# EQC_CAPTURE_URL_SUBSTR=/kg-api-hfd/api/search/

# [Troubleshooting]
# If token is captured too early (false positive), narrow capture URLs or enable
# a stricter set; multiple values separated by commas.
# EQC_CAPTURE_URL_SUBSTR=/kg-api-hfd/api/search/,/kg-api-hfd/api/userinfo
# To diagnose login issues, temporarily disable auto slider:
# EQC_AUTO_SLIDER=false

# =============================================================================
# COMPANY ENRICHMENT CONFIGURATION
# =============================================================================
# See reference/01_company_id_analysis.md for comprehensive documentation
# This configuration controls the company ID enrichment service which resolves
# customer names to canonical company IDs using internal mappings and external APIs

# REQUIRED: Salt for generating stable temporary IDs (IN_<hash>)
# Generate a new salt: python -c "import secrets; print(secrets.token_hex(32))"
# IMPORTANT: Change this in production and keep it secret
WDH_ALIAS_SALT=your_secret_salt_here_change_in_production

# Enable company ID enrichment service (0=disabled, 1=enabled)
# Set to 0 to disable enrichment completely (pipeline uses raw customer names)
WDH_ENRICH_COMPANY_ID=0

# Sync lookup budget: max external API calls per pipeline run (0=disabled)
# Controls how many external API calls are allowed during main pipeline execution
# to prevent blocking. Remaining lookups are queued for async processing.
WDH_ENRICH_SYNC_BUDGET=0

# Provider selection: stub (testing), eqc (production), legacy (migration)
# - stub: Offline fixtures for testing/CI (no external dependencies)
# - eqc: Real EQC platform API integration (requires WDH_PROVIDER_EQC_TOKEN)
# - legacy: Adapter for existing Mongo/MySQL crawler (optional)
WDH_ENTERPRISE_PROVIDER=stub

# EQC API Configuration (required if WDH_ENTERPRISE_PROVIDER=eqc)
# Token expires after 30 minutes - refresh via auth automation
# WDH_PROVIDER_EQC_TOKEN=

# Optional: Override default EQC API endpoint
# WDH_PROVIDER_EQC_BASE_URL=

# -----------------------------------------------------------------------------
# Simplified Approach Configuration (S-001~S-004)
# -----------------------------------------------------------------------------
# These settings are used if implementing the simplified enrichment approach
# instead of the full complex approach with Provider/Gateway abstraction

# Enable simplified enrichment service (0=disabled, 1=enabled)
WDH_COMPANY_ENRICHMENT_ENABLED=0

# Sync lookup limit for simplified approach
WDH_COMPANY_SYNC_LOOKUP_LIMIT=5

# -----------------------------------------------------------------------------
# Queue Processing Configuration
# -----------------------------------------------------------------------------
# Controls async enrichment queue processing for deferred company lookups

# Batch size for processing enrichment queue
WDH_LOOKUP_QUEUE_BATCH_SIZE=50

# Maximum retry attempts for failed lookups
WDH_LOOKUP_RETRY_MAX=3

# Delay between retry attempts (in seconds)
WDH_LOOKUP_RETRY_DELAY=300
